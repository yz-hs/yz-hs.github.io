<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="msvalidate.01" content="A7B4DB5A7BF5E5C6E52E34BB024D6319"><meta name="description" content="本站为 Yurchiu 用来记录 OI、笔记、感想的 Blog，欢迎来到本博客！希望我们能相互交流，共同进步～"><meta http-equiv="content-language" content="zh-cn"><title>一些关于树套树的题目 | Yurchiu's Blog</title><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.min.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.17/sweetalert2.all.min.js"></script><script src="https://cdn.staticfile.org/sketch.js/1.0/sketch.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/js/chaffle.js"></script><script src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/js/main.js"></script><script src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/js/search.js"></script><script src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/js/initial.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.6/katex.min.css"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/vs2015.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/css/style.css"><link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Yurchiu's Blog" type="application/atom+xml"></head><body style="background-image:url(https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/new-bgp.png)"><div id="YurLoading" class="YurLoading"><div class="inner"><div class="line-wrap"><div class="line"></div></div><div class="line-wrap"><div class="line"></div></div><div class="line-wrap"><div class="line"></div></div><div class="line-wrap"><div class="line"></div></div><div class="line-wrap"><div class="line"></div></div></div></div><div class="topbar"><a onclick="topbarToggle()" class="topbar-menu" style="cursor:pointer"><i class="fa fa-bars"></i> </a><a href="/" class="topbar-title"><i class="fa fa-home"></i> Yurchiu's Blog </a><a target="_blank" rel="noopener" href="https://github.com/yz-hs" class="topbar-title"><i class="fa fa-github"></i></a></div><div id="article-container"><div class="sidebar"><div class="avatar-container"><img src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/new-avatar.jpg" class="avatar revolve"></div><div class="sidebar-author">Yurchiu<br><span class="mini-text">An AFO whker.</span></div><div class="sidebar-list-container"><div style="height:10px"></div><a class="list-group-item" href="/"><div><i class="fa fa-home fa-fw"></i>&nbsp; 首页</div><div class="badge"></div></a><a class="list-group-item" href="/archives/"><div><i class="fa fa-tasks fa-fw"></i>&nbsp; 归档</div><div class="badge">158</div></a><a class="list-group-item" href="/tags/"><div><i class="fa fa-tags fa-fw"></i>&nbsp; 标签</div><div class="badge">81</div></a><a class="list-group-item" href="/categories/"><div><i class="fa fa-th-large fa-fw"></i>&nbsp; 分类</div><div class="badge">24</div></a><a class="list-group-item" href="/somepage/mood/"><div><i class="fa fa-photo fa-fw"></i>&nbsp; 说说</div><div class="badge"></div></a><a class="list-group-item" href="/somepage/about/"><div><i class="fa fa-user-o fa-fw"></i>&nbsp; 关于</div><div class="badge"></div></a><a class="list-group-item" href="/somepage/chat/"><div><i class="fa fa-commenting-o fa-fw"></i>&nbsp; 留言</div><div class="badge"></div></a><a class="list-group-item" href="/somepage/link/"><div><i class="fa fa-link fa-fw"></i>&nbsp; 链接</div><div class="badge"></div></a><a class="list-group-item" href="/somepage/settings/"><div><i class="fa fa-cog fa-fw"></i>&nbsp; 设置</div><div class="badge"></div></a><div style="height:200px"></div></div><div class="sidebar-footer"><div class="item" id="back2Top" data-bs-toggle="tooltip" title="顶部"><i class="fa fa-arrow-circle-up"></i></div><div class="item" id="back2Down" data-bs-toggle="tooltip" title="底部"><i class="fa fa-arrow-circle-down"></i></div><div class="item" data-bs-toggle="tooltip" title="RSS"><a href="/atom.xml"><i class="fa fa-feed"></i></a></div><div class="item" data-bs-toggle="tooltip" title="搜索"><a href="/somepage/search/"><i class="fa fa-search"></i></a></div></div></div><div class="article"><div class="vertical fake-sidebar"></div><div class="vertical post"><div class="header"><h1 class="title">一些关于树套树的题目</h1><div class="meta"><span><i class="fa fa-user-o"></i> Yurchiu </span><span><i class="fa fa-clock-o"></i> 2021-07-02, 22:09:36</span> <span><i class="fa fa-font"></i> 2.2k</span> <span class="hideBars" onclick="hideBars()"><i class="fa fa-eye-slash"></i> 隐藏左右两栏 </span><span class="showBars" onclick="showBars()"><i class="fa fa-eye"></i> 展示左右两栏</span></div></div><div class="breadcrumb"><div class="url"><a href="/"><i class="fa fa-home"></i> 首页</a> / 一些关于树套树的题目</div><div class="share">分享到 <a target="_blank" rel="noopener" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://yz-hs.github.io/4b5701f09701/&title=一些关于树套树的题目&site=https://yz-hs.github.io"><i class="fa fa-qq"></i></a></div></div><div class="post-text"><p><strong>树套树</strong>，顾名思义，就是要将两种或多种树形数据结构结合起来，解决一些单独无法解决的问题。</p><span id="more"></span><h1 id="p3157-cqoi2011动态逆序对"><a class="markdownIt-Anchor" href="#p3157-cqoi2011动态逆序对"></a> P3157 [CQOI2011]动态逆序对</h1><h2 id="题意"><a class="markdownIt-Anchor" href="#题意"></a> 题意</h2><p>现在给出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1\sim n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span> 的一个排列，按照某种顺序依次删除 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span> 个元素，你的任务是在每次删除一个元素<strong>之前</strong>统计整个序列的逆序对数。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">1\le n \le 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.78041em;vertical-align:-.13597em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.7719400000000001em;vertical-align:-.13597em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>50000</mn></mrow><annotation encoding="application/x-tex">1\le m \le 50000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.78041em;vertical-align:-.13597em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.7719400000000001em;vertical-align:-.13597em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span>。</p><details><summary>点击查看题解</summary><h2 id="题解"><a class="markdownIt-Anchor" href="#题解"></a> 题解</h2><p>利用树状数组套动态开点线段树来解决这个问题。</p><p>使用树状数组维护进行区间前缀和统计，每个树状数组节点管理一个动态开点权值线段树；树状数组将区间划分开，使用动态开点权值线段树维护各自区间中数字出现个数。</p><p>考虑删掉一个点位置是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>，值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 对逆序对减少的贡献。寻找 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,i-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 的个数以及 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[i+1,n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span> 小于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.58056em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 的个数（这里的“区间”是指位置）。</p><p>时间复杂度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n \log^2 n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mop"><span class="mop">lo<span style="margin-right:.01389em">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8984479999999999em"><span style="top:-3.1473400000000002em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p><h2 id="代码"><a class="markdownIt-Anchor" href="#代码"></a> 代码</h2><pre class="highlight"><code class="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">namespace</span> _yz 
&#123;
	<span class="hljs-comment">//树状数组套动态开点线段树</span>
	<span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> ll;<span class="hljs-comment">//（手动滑稽</span>
	<span class="hljs-type">const</span> ll N=<span class="hljs-number">100000</span>+<span class="hljs-number">10</span>,M=<span class="hljs-number">1000000000</span>;
	ll cnt=<span class="hljs-number">0</span>,n,m,pos[N],root[N];
	<span class="hljs-type">long</span> <span class="hljs-type">long</span> ans=<span class="hljs-number">0</span>,del=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SGT</span>
	&#123;
		<span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span>&#123;<span class="hljs-type">int</span> lson,rson,data;&#125;t[N*<span class="hljs-number">30</span>*<span class="hljs-number">30</span>];
		<span class="hljs-meta">#<span class="hljs-keyword">define</span> lson t[root].lson</span>
		<span class="hljs-meta">#<span class="hljs-keyword">define</span> rson t[root].rson</span>
		<span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)/2)</span>
		<span class="hljs-function">ll <span class="hljs-title">update</span><span class="hljs-params">(ll root,ll l,ll r,ll pos,ll data)</span>
		</span>&#123;
			<span class="hljs-keyword">if</span>(root==<span class="hljs-number">0</span>) root=++cnt;
			<span class="hljs-keyword">if</span>(l==r&amp;&amp;r==pos)
			&#123;
				t[root].data+=data;
				<span class="hljs-keyword">return</span> root;
			&#125;
			<span class="hljs-keyword">if</span>(pos&lt;=mid) lson=<span class="hljs-built_in">update</span>(lson,l,mid,pos,data);
			<span class="hljs-keyword">else</span> rson=<span class="hljs-built_in">update</span>(rson,mid+<span class="hljs-number">1</span>,r,pos,data);
			t[root].data=t[lson].data+t[rson].data;
			<span class="hljs-keyword">return</span> root;
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">query</span><span class="hljs-params">(ll root,ll l,ll r,ll x,ll y)</span>
		</span>&#123;
			ll ret=<span class="hljs-number">0</span>;
			<span class="hljs-keyword">if</span>(root==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			<span class="hljs-keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y) <span class="hljs-keyword">return</span> t[root].data;
			<span class="hljs-keyword">if</span>(x&lt;=mid) ret+=<span class="hljs-built_in">query</span>(lson,l,mid,x,y);
			<span class="hljs-keyword">if</span>(y&gt;=mid+<span class="hljs-number">1</span>) ret+=<span class="hljs-built_in">query</span>(rson,mid+<span class="hljs-number">1</span>,r,x,y);
			<span class="hljs-keyword">return</span> ret;
		&#125;
	&#125;Tree;
	<span class="hljs-function">ll <span class="hljs-title">lb</span><span class="hljs-params">(ll x)</span></span>&#123;<span class="hljs-keyword">return</span> x&amp;-x;&#125;
	<span class="hljs-function">ll <span class="hljs-title">query</span><span class="hljs-params">(ll rt,ll x,ll y)</span>
	</span>&#123;
		ll ret=<span class="hljs-number">0</span>;
		<span class="hljs-keyword">while</span>(rt&gt;=<span class="hljs-number">1</span>)
		&#123;
			ret+=Tree.<span class="hljs-built_in">query</span>(root[rt],<span class="hljs-number">1</span>,n,x,y);
			rt-=<span class="hljs-built_in">lb</span>(rt);
		&#125;
		<span class="hljs-keyword">return</span> ret;
	&#125;
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(ll rt,ll x,ll data)</span>
	</span>&#123;
		<span class="hljs-keyword">while</span>(rt&lt;=n)
		&#123;
			root[rt]=Tree.<span class="hljs-built_in">update</span>(root[rt],<span class="hljs-number">1</span>,n,x,data);
			rt+=<span class="hljs-built_in">lb</span>(rt);
		&#125;
		<span class="hljs-keyword">return</span>;
	&#125;
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">yzmain</span><span class="hljs-params">()</span>
	</span>&#123;
		ll tmp,root;
		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)
		&#123;
			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;tmp);
			pos[tmp]=i;
			ans+=<span class="hljs-built_in">query</span>(i<span class="hljs-number">-1</span>,tmp+<span class="hljs-number">1</span>,n);
			<span class="hljs-built_in">update</span>(i,tmp,<span class="hljs-number">1</span>);
		&#125;
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)
		&#123;
			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;tmp);
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);
			root=pos[tmp];del=<span class="hljs-number">0</span>;
			del+=<span class="hljs-built_in">query</span>(root<span class="hljs-number">-1</span>,tmp+<span class="hljs-number">1</span>,n);
			del+=<span class="hljs-built_in">query</span>(n,<span class="hljs-number">0</span>,tmp<span class="hljs-number">-1</span>);<span class="hljs-comment">//由于树状数组维护的是前缀和，</span>
			del-=<span class="hljs-built_in">query</span>(root,<span class="hljs-number">0</span>,tmp<span class="hljs-number">-1</span>);<span class="hljs-comment">//所以这样搞。</span>
			ans-=del;
			<span class="hljs-built_in">update</span>(root,tmp,<span class="hljs-number">-1</span>);
		&#125;
		<span class="hljs-keyword">return</span>;
	&#125;
&#125;
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
	_yz::<span class="hljs-built_in">yzmain</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;
</code></pre></details><h1 id="p3380-模板二逼平衡树树套树"><a class="markdownIt-Anchor" href="#p3380-模板二逼平衡树树套树"></a> P3380 【模板】二逼平衡树（树套树）</h1><h2 id="题意-2"><a class="markdownIt-Anchor" href="#题意-2"></a> 题意</h2><p>您需要写一种数据结构（可参考题目标题），来维护一个有序数列，其中需要提供以下操作：</p><ol><li>查询 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 在区间内的排名；</li><li>查询区间内排名为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 的值；</li><li>修改某一位值上的数值；</li><li>查询 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 在区间内的前驱（前驱定义为严格小于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">x</span></span></span></span>，且最大的数，<strong>若不存在输出 <code>-2147483647</code></strong>）；</li><li>查询 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 在区间内的后继（后继定义为严格大于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">x</span></span></span></span>，且最小的数，<strong>若不存在输出 <code>2147483647</code></strong>）。</li></ol><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo>≤</mo><mn>5</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">1≤n,m≤5×10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.78041em;vertical-align:-.13597em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.8304100000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">5</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span>，序列中的值在任何时刻 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\in[0,10^8]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>。</p><details><summary>点击查看题解</summary><h2 id="题解-2"><a class="markdownIt-Anchor" href="#题解-2"></a> 题解</h2><p>模板题，不用多说。这里使用 线段树+Splay 实现，<s>开 O2 优化也过不了</s>。</p><p>由于操作中包含区间的限制，所以利用线段树来维护整个数列，每颗节点都开一棵平衡树，管理这个节点维护的范围内的数。</p><p><s>调这个代码用了 26 小时，写完之后感觉自己就是二逼</s>。</p><h2 id="代码-2"><a class="markdownIt-Anchor" href="#代码-2"></a> 代码</h2><pre class="highlight"><code class="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">namespace</span> _yz
&#123;
	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ms(a) memset(a,0,sizeof(a))</span>
	<span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;
	<span class="hljs-type">const</span> ll N=<span class="hljs-number">3000000</span>+<span class="hljs-number">10</span>,inf=<span class="hljs-number">2147483647</span>;
	ll n,m,a[N],opt,l,r,x;
	<span class="hljs-function">ll <span class="hljs-title">read</span><span class="hljs-params">()</span>
	</span>&#123;
		ll x=<span class="hljs-number">0</span>,f=<span class="hljs-number">1</span>;
		<span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();
		<span class="hljs-keyword">while</span>(!<span class="hljs-built_in">isdigit</span>(ch))
		&#123;
			<span class="hljs-keyword">if</span>(ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>;
			ch=<span class="hljs-built_in">getchar</span>();
		&#125;
		<span class="hljs-keyword">while</span>(<span class="hljs-built_in">isdigit</span>(ch))
		&#123;
			x=(x&lt;&lt;<span class="hljs-number">3</span>)+(x&lt;&lt;<span class="hljs-number">1</span>)+(ch^<span class="hljs-number">48</span>);
			ch=<span class="hljs-built_in">getchar</span>();
		&#125;
		<span class="hljs-keyword">return</span> x*f;
	&#125;
	<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Splay</span>
	&#123;
		ll son[N][<span class="hljs-number">2</span>],data[N],num[N],size[N],dad[N];
		ll cnt;
		<span class="hljs-built_in">Splay</span>()
		&#123;
			<span class="hljs-built_in">ms</span>(son);<span class="hljs-built_in">ms</span>(data);<span class="hljs-built_in">ms</span>(num);
			<span class="hljs-built_in">ms</span>(size);<span class="hljs-built_in">ms</span>(dad);cnt=<span class="hljs-number">0</span>;
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitor</span><span class="hljs-params">(ll root)</span>
		</span>&#123;
			<span class="hljs-keyword">if</span>(son[root][<span class="hljs-number">0</span>]) <span class="hljs-built_in">visitor</span>(son[root][<span class="hljs-number">0</span>]);
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld &quot;</span>,data[root]);
			<span class="hljs-keyword">if</span>(son[root][<span class="hljs-number">1</span>]) <span class="hljs-built_in">visitor</span>(son[root][<span class="hljs-number">1</span>]);
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(ll pos)</span>
		</span>&#123;
			size[pos]=num[pos]+size[son[pos][<span class="hljs-number">0</span>]]+size[son[pos][<span class="hljs-number">1</span>]];
			<span class="hljs-keyword">return</span>; <span class="hljs-comment">//size 只需要在 pushup 时更新 </span>
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">check</span><span class="hljs-params">(ll pos)</span></span>&#123;<span class="hljs-keyword">return</span> son[dad[pos]][<span class="hljs-number">1</span>]==pos;&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(ll pos)</span>
		</span>&#123;
			ll par=dad[pos],gpar=dad[par],way=<span class="hljs-built_in">check</span>(pos);
			ll son2=son[pos][way^<span class="hljs-number">1</span>];
			son[gpar][<span class="hljs-built_in">check</span>(par)]=pos; dad[pos]=gpar;     
			son[par][way]=son2;        dad[son2]=par;
			son[pos][way^<span class="hljs-number">1</span>]=par;       dad[par]=pos;                              
			<span class="hljs-built_in">pushup</span>(par);               <span class="hljs-built_in">pushup</span>(pos);                              
			<span class="hljs-keyword">return</span>;
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">splay</span><span class="hljs-params">(ll &amp;root,ll pos,ll des)</span><span class="hljs-comment">//不要误认为 des 是根节点 </span>
		</span>&#123;
			<span class="hljs-keyword">while</span>(dad[pos]!=des)
			&#123;
				ll par=dad[pos],gpar=dad[par];
				<span class="hljs-keyword">if</span>(gpar!=des)
				&#123;
					<span class="hljs-keyword">if</span>(<span class="hljs-built_in">check</span>(pos)==<span class="hljs-built_in">check</span>(par)) <span class="hljs-built_in">rotate</span>(par);        
					<span class="hljs-keyword">else</span> <span class="hljs-built_in">rotate</span>(pos);
				&#125;
				<span class="hljs-built_in">rotate</span>(pos);
			&#125;
			<span class="hljs-keyword">if</span>(des==<span class="hljs-number">0</span>) root=pos;
		&#125;
		ll _new(ll val,ll fa)
		&#123;
			data[++cnt]=val;dad[cnt]=fa;
			num[cnt]=<span class="hljs-number">1</span>;
			<span class="hljs-built_in">pushup</span>(cnt);
			<span class="hljs-keyword">return</span> cnt;
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(ll &amp;root,ll val)</span>
		</span>&#123;
			ll pos=root,fa=<span class="hljs-number">0</span>,way=(val&gt;data[pos]);
			<span class="hljs-keyword">if</span>(!pos) &#123;pos=_new(val,<span class="hljs-number">0</span>);root=pos;<span class="hljs-keyword">return</span>;&#125;<span class="hljs-comment">//特判根为空的情况 </span>
			<span class="hljs-keyword">while</span>(pos&amp;&amp;data[pos]!=val)
			&#123;
				fa=pos;
				pos=son[pos][way];
				way=(val&gt;data[pos]);
			&#125;
			<span class="hljs-keyword">if</span>(pos) num[pos]++;
			<span class="hljs-keyword">else</span>&#123;
				pos=_new(val,fa);
				<span class="hljs-keyword">if</span>(fa) son[fa][data[fa]&lt;val]=pos;
			&#125;
			<span class="hljs-built_in">splay</span>(root,pos,<span class="hljs-number">0</span>);
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">find</span><span class="hljs-params">(ll &amp;root,ll x)</span>
		</span>&#123;
			ll pos=root,way=(x&gt;data[pos]);
			<span class="hljs-keyword">if</span>(!pos) <span class="hljs-keyword">return</span>;
			<span class="hljs-keyword">while</span>(data[pos]!=x&amp;&amp;son[pos][way])
			&#123;
				pos=son[pos][way];
				way=(x&gt;data[pos]);
			&#125;
			<span class="hljs-built_in">splay</span>(root,pos,<span class="hljs-number">0</span>);
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">rank</span><span class="hljs-params">(ll &amp;root,ll val)</span>
		</span>&#123;
			<span class="hljs-built_in">find</span>(root,val);
			ll pos=son[root][<span class="hljs-number">0</span>];<span class="hljs-comment">//平衡树中存在，好说 </span>
			<span class="hljs-keyword">if</span>(data[root]&gt;=val) <span class="hljs-keyword">return</span> size[pos]<span class="hljs-number">-1</span>;
			<span class="hljs-comment">//如果不存在，且值比 data 小，其排名等价于 data 的排名 </span>
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> size[pos]+num[root]<span class="hljs-number">-1</span>;
			<span class="hljs-comment">//反之，且值比 data 大，其排名等价于 data 的后继排名 </span>
			<span class="hljs-comment">//注意减去 -inf 的排名 </span>
			<span class="hljs-comment">//返回的是比 val 小的数的个数 </span>
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">pre</span><span class="hljs-params">(ll &amp;root,ll val)</span>
		</span>&#123;
			<span class="hljs-built_in">find</span>(root,val);
			ll pos=root;
			<span class="hljs-keyword">if</span>(data[pos]&lt;val) <span class="hljs-keyword">return</span> pos;
			pos=son[pos][<span class="hljs-number">0</span>];
			<span class="hljs-keyword">while</span>(son[pos][<span class="hljs-number">1</span>]) pos=son[pos][<span class="hljs-number">1</span>];
			<span class="hljs-keyword">return</span> pos;
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">suc</span><span class="hljs-params">(ll &amp;root,ll val)</span>
		</span>&#123;
			<span class="hljs-built_in">find</span>(root,val);
			ll pos=root;
			<span class="hljs-keyword">if</span>(data[pos]&gt;val) <span class="hljs-keyword">return</span> pos;
			pos=son[pos][<span class="hljs-number">1</span>];
			<span class="hljs-keyword">while</span>(son[pos][<span class="hljs-number">0</span>]) pos=son[pos][<span class="hljs-number">0</span>];
			<span class="hljs-keyword">return</span> pos;
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(ll &amp;root,ll val)</span> 
		</span>&#123;
		    ll l=<span class="hljs-built_in">pre</span>(root,val),r=<span class="hljs-built_in">suc</span>(root,val);
		    <span class="hljs-built_in">splay</span>(root,r,<span class="hljs-number">0</span>);<span class="hljs-built_in">splay</span>(root,l,r);
		    ll pos=son[l][<span class="hljs-number">1</span>];
		    <span class="hljs-keyword">if</span>(data[pos]!=val) <span class="hljs-keyword">return</span>;
		    <span class="hljs-keyword">if</span>(num[pos]&gt;<span class="hljs-number">1</span>)
		    	num[pos]--,<span class="hljs-built_in">splay</span>(root,pos,<span class="hljs-number">0</span>);
			<span class="hljs-keyword">else</span> son[l][<span class="hljs-number">1</span>]=<span class="hljs-number">0</span>;
			<span class="hljs-built_in">pushup</span>(l);<span class="hljs-comment">/*注意 pushup 的对象*/</span>
		&#125;
	&#125;BST;
	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p*2)</span>
	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs ((p*2)+1)</span>
	<span class="hljs-meta">#<span class="hljs-keyword">define</span> mid ((l+r)/2)</span>
	<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Seg_tree</span>
	&#123;
		ll root[N];
		<span class="hljs-built_in">Seg_tree</span>()&#123;<span class="hljs-built_in">ms</span>(root);&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(ll p,ll l,ll r,ll x,ll y)</span>
		</span>&#123;
			<span class="hljs-keyword">if</span>(!root[p])
			&#123;
				BST.<span class="hljs-built_in">insert</span>(root[p],-inf);
				BST.<span class="hljs-built_in">insert</span>(root[p],inf);
			&#125;
			BST.<span class="hljs-built_in">insert</span>(root[p],y);
			<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;
			<span class="hljs-keyword">if</span>(x&lt;=mid) <span class="hljs-built_in">insert</span>(ls,l,mid,x,y);
			<span class="hljs-keyword">else</span> <span class="hljs-built_in">insert</span>(rs,mid+<span class="hljs-number">1</span>,r,x,y);
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(ll p,ll l,ll r,ll x,ll y)</span>
		</span>&#123;
			BST.<span class="hljs-built_in">remove</span>(root[p],a[x]);
			BST.<span class="hljs-built_in">insert</span>(root[p],y);
			<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;
			<span class="hljs-keyword">if</span>(x&lt;=mid) <span class="hljs-built_in">update</span>(ls,l,mid,x,y);
			<span class="hljs-keyword">else</span> <span class="hljs-built_in">update</span>(rs,mid+<span class="hljs-number">1</span>,r,x,y);
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">rank</span><span class="hljs-params">(ll p,ll l,ll r,ll x,ll y,ll k)</span>
		</span>&#123;
			ll ret=<span class="hljs-number">0</span>;
			<span class="hljs-keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y) <span class="hljs-keyword">return</span> BST.<span class="hljs-built_in">rank</span>(root[p],k);
			<span class="hljs-keyword">if</span>(x&lt;=mid) ret+=<span class="hljs-built_in">rank</span>(ls,l,mid,x,y,k);
			<span class="hljs-keyword">if</span>(y&gt;=mid+<span class="hljs-number">1</span>) ret+=<span class="hljs-built_in">rank</span>(rs,mid+<span class="hljs-number">1</span>,r,x,y,k);
			<span class="hljs-keyword">return</span> ret;
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">atrank</span><span class="hljs-params">(ll p,ll x,ll y,ll k)</span>
		</span>&#123;
			ll l=<span class="hljs-number">0</span>,r=<span class="hljs-number">100000000</span>,ans;
			<span class="hljs-keyword">while</span>(l&lt;=r)
			&#123;
				ll check=<span class="hljs-built_in">rank</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,x,y,mid)+<span class="hljs-number">1</span>;
				ll M=mid;
				<span class="hljs-comment">//printf(&quot;%lld %lld\n&quot;,M,check); </span>
				<span class="hljs-keyword">if</span>(check&gt;k) r=M<span class="hljs-number">-1</span>;
				<span class="hljs-keyword">else</span> l=M+<span class="hljs-number">1</span>,ans=M;
			&#125;
			<span class="hljs-keyword">return</span> ans;
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">pre</span><span class="hljs-params">(ll p,ll l,ll r,ll x,ll y,ll k)</span>
		</span>&#123;
			<span class="hljs-keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y) <span class="hljs-keyword">return</span> BST.data[BST.<span class="hljs-built_in">pre</span>(root[p],k)];
			ll al=-inf,ar=-inf;
			<span class="hljs-keyword">if</span>(x&lt;=mid) al=<span class="hljs-built_in">pre</span>(ls,l,mid,x,y,k);
			<span class="hljs-keyword">if</span>(y&gt;=mid+<span class="hljs-number">1</span>) ar=<span class="hljs-built_in">pre</span>(rs,mid+<span class="hljs-number">1</span>,r,x,y,k);
			<span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(al,ar);
		&#125;
		<span class="hljs-function">ll <span class="hljs-title">suc</span><span class="hljs-params">(ll p,ll l,ll r,ll x,ll y,ll k)</span>
		</span>&#123;
			<span class="hljs-keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y) <span class="hljs-keyword">return</span> BST.data[BST.<span class="hljs-built_in">suc</span>(root[p],k)];
			ll al=inf,ar=inf;
			<span class="hljs-keyword">if</span>(x&lt;=mid) al=<span class="hljs-built_in">suc</span>(ls,l,mid,x,y,k);
			<span class="hljs-keyword">if</span>(y&gt;=mid+<span class="hljs-number">1</span>) ar=<span class="hljs-built_in">suc</span>(rs,mid+<span class="hljs-number">1</span>,r,x,y,k);
			<span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(al,ar);
		&#125;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">visitor</span><span class="hljs-params">(ll p,ll l,ll r)</span>
		</span>&#123;
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[%lld,%lld]\n&quot;</span>,l,r);
			BST.<span class="hljs-built_in">visitor</span>(root[p]);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);
			<span class="hljs-keyword">if</span>(l==r) <span class="hljs-keyword">return</span>;
			<span class="hljs-built_in">visitor</span>(ls,l,mid);
			<span class="hljs-built_in">visitor</span>(rs,mid+<span class="hljs-number">1</span>,r);
		&#125;
	&#125;SGT;
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">yzmain</span><span class="hljs-params">()</span>
	</span>&#123;
		n=<span class="hljs-built_in">read</span>(),m=<span class="hljs-built_in">read</span>();
		<span class="hljs-keyword">for</span>(ll i=<span class="hljs-number">1</span>;i&lt;=n;i++)
		&#123;
			a[i]=<span class="hljs-built_in">read</span>();
			SGT.<span class="hljs-built_in">insert</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,i,a[i]);
		&#125;
		<span class="hljs-keyword">for</span>(ll i=<span class="hljs-number">1</span>;i&lt;=m;i++)
		&#123;
			opt=<span class="hljs-built_in">read</span>();
			<span class="hljs-keyword">if</span>(opt==<span class="hljs-number">3</span>)
			&#123;
				l=<span class="hljs-built_in">read</span>(),x=<span class="hljs-built_in">read</span>();
				SGT.<span class="hljs-built_in">update</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,l,x);
				a[l]=x;
			&#125;
			<span class="hljs-keyword">else</span>
			&#123;
				ll ans=<span class="hljs-number">0</span>;
				l=<span class="hljs-built_in">read</span>(),r=<span class="hljs-built_in">read</span>(),x=<span class="hljs-built_in">read</span>();
				<span class="hljs-keyword">if</span>(opt==<span class="hljs-number">1</span>) ans=SGT.<span class="hljs-built_in">rank</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,l,r,x)+<span class="hljs-number">1</span>;
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(opt==<span class="hljs-number">2</span>) ans=SGT.<span class="hljs-built_in">atrank</span>(<span class="hljs-number">1</span>,l,r,x);
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(opt==<span class="hljs-number">4</span>) ans=SGT.<span class="hljs-built_in">pre</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,l,r,x);
				<span class="hljs-keyword">else</span> ans=SGT.<span class="hljs-built_in">suc</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,l,r,x);
				<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>,ans);
			&#125;
		&#125;
		<span class="hljs-keyword">return</span>;
	&#125;
&#125;
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
	_yz::<span class="hljs-built_in">yzmain</span>();
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;
</code></pre></details><br><hr><br><blockquote><br>本文作者：Yurchiu<br><br>本文链接：https://yz-hs.github.io/4b5701f09701/<br><br>版权声明：本博客中所有原创文章除特别声明外，均允许规范转载，转载请注明出处。所有非原创文章，按照原作者要求转载。<br><br></blockquote><br><div class="end-post-meta"><span><a href="/tags/OI"><i class="fa fa-tag"></i> OI</a></span> <span><a href="/tags/树"><i class="fa fa-tag"></i> 树</a></span> <span><a href="/tags/树状数组"><i class="fa fa-tag"></i> 树状数组</a></span> <span><a href="/tags/线段树"><i class="fa fa-tag"></i> 线段树</a></span> <span><a href="/tags/一些"><i class="fa fa-tag"></i> 一些</a></span> <span><a href="/tags/动态开点线段树"><i class="fa fa-tag"></i> 动态开点线段树</a></span></div><div class="end-post-meta"><span><i class="fa fa-refresh"></i> 最后更新：2023-08-21, 23:18:21</span></div></div><div class="prevnext"><a class="prev" href="/1b12e9984a40/">上一页</a> <a class="next" href="/be4dde0f66a1/">下一页</a></div><div class="comments"><div class="giscus"></div><script>function my_giscus_load(){var t=document.createElement("script");t.setAttribute("src","https://giscus.app/client.js"),t.setAttribute("data-repo","yz-hs/no-star"),t.setAttribute("data-repo-id","R_kgDOKHnuhg"),t.setAttribute("data-category","General"),t.setAttribute("data-category-id","DIC_kwDOKHnuhs4CYog9"),t.setAttribute("data-mapping","pathname"),t.setAttribute("data-strict","0"),t.setAttribute("data-reactions-enabled","1"),t.setAttribute("data-emit-metadata","0"),t.setAttribute("data-input-position","top"),t.setAttribute("data-theme","light"),4==readData("color")&&t.setAttribute("data-theme","dark"),t.setAttribute("data-lang","zh-CN"),t.setAttribute("data-loading","lazy"),t.setAttribute("crossorigin","anonymous"),t.setAttribute("async","true"),document.head.appendChild(t)}my_giscus_load()</script></div><div class="avatar-container" style="padding:50px"><img src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/new-avatar.jpg" class="avatar revolve" style="height:12%;width:12%"><div style="text-align:center;margin-top:3%">By Yurchiu.</div></div></div><div class="vertical toolbar"><div class="tab-page"><div class="tabTitle tb-tabTitle"><ul><li class="current"><i class="fa fa-random"></i></li><li><i class="fa fa-refresh"></i></li><li><i class="fa fa-circle-o-notch"></i></li></ul></div><div class="tabContent tb-tabContent"><div><div class="title">随机文章<span class="sidetitle">回味旧文</span></div><div class="item no-lrpadding"><a class="post-link" href="/d24d99489782/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">2020 新年贺词</div></div></a><a class="post-link" href="/501647d25831/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">AFO 有感</div></div></a><a class="post-link" href="/3513c6ef3e31/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">2021，初中毕业</div></div></a><a class="post-link" href="/3f5d366e12dd/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">一个 4 人囚徒困境的必胜策略</div></div></a><a class="post-link" href="/ed885af1fef5/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">ASCII 艺术</div></div></a><a class="post-link" href="/2ab979d324b5/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">BSGS 与 exBSGS</div></div></a><a class="post-link" href="/1ed002c31ce3/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">CSP-J1 游记</div></div></a></div></div><div class="hide"><div class="title">最近更新<span class="sidetitle">旧文更新</span></div><div class="item no-lrpadding"><a class="post-link" href="/b5c9603ceb3e/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">【空间向量】叉积</div></div></a><a class="post-link" href="/251a7b12764a/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">[Works] 自白 终章</div></div></a><a class="post-link" href="/d3dec5d93e6e/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">欢迎</div></div></a><a class="post-link" href="/39e4c172e542/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">Cutie 使用文档</div></div></a><a class="post-link" href="/6515fc8a93b1/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">《幽默报》</div></div></a><a class="post-link" href="/942883c5ce30/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">《幽默报 007》</div></div></a><a class="post-link" href="/32cc033936e2/"><div class="title_fa"><i class="fa fa-file-text-o fa-border" style="height:30px;border:none"></i><div class="title">[Theme] Readme</div></div></a></div></div><div class="hide"><div class="title">其他物件<a data-bs-toggle="tooltip" href="javascript: document.body.contentEditable='true';
    document.designMode='on';void(0);" title="彩蛋：点击我，可以编辑本页面！" target="_self" class="sidetitle">杂物收纳</a></div><div style="height:10px"></div><div class="item"><tag style="display:inline-block">Hitokoto</tag><br><br><div id="hitokoto">Yurchiu 说，除了她以外的人都很强！嘤嘤嘤~~</div><script>fetch("https://v1.hitokoto.cn").then(function(t){return t.json()}).then(function(t){$("#hitokoto").html(t.hitokoto+"<br><br><div style='text-align: right;'>——"+t.from+"</div>")}).catch(function(t){console.error(t)})</script></div><div class="item"><div id="timeprogress"></div><script>var myDate=new Date,hours=myDate.getHours(),minutes=myDate.getMinutes(),pro=(minutes=60*hours+minutes)/14.4,innerhtml="        <div class='progress' style='height: 20px'>          <div data-bs-toggle='tooltip'               class='progress-bar'               title='时间已过去了 "+pro.toFixed(2)+"%'               style='width: "+pro+"%;               background: #4caf50; color: #fff;'>"+pro.toFixed(0)+"%          </div>        </div>";document.getElementById("timeprogress").innerHTML=innerhtml</script></div></div></div></div><div class="item"><div class="title">博客信息</div><div class="list-group"><div class="list-group-item"><div><i class="fa fa-file-text-o fa-fw"></i> 文章数目</div><div class="badge">158</div></div><div class="list-group-item"><div><i class="fa fa-refresh fa-fw"></i> 最近更新</div><div class="badge">08-21</div></div><div class="list-group-item"><div><i class="fa fa-font fa-fw"></i> 本站字数</div><div class="badge">346.1k</div></div></div></div><div class="post-toc"><div class="title">文章目录</div><div class="post-toc-inner"></div></div><script>tocbot.init({tocSelector:".post-toc-inner",contentSelector:".post-text",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0})</script><script>$(function(){var i=$(".tb-tabTitle>ul>li"),n=$(".tb-tabContent>div");i.click(function(){var t=$(this);setTimeout(function(){t.addClass("current").siblings().removeClass("current");var i=t.index();n.eq(i).show().siblings().hide()})})})</script></div></div><div class="footer"><p class="text-left">©2019-2023 <a target="_blank" rel="noopener" href="https://github.com/yz-hs">Yurchiu</a>. All rights reserved.</p><p class="text-right">Theme <a target="_blank" rel="noopener" href="https://github.com/yz-hs/cutie">Cutie</a>, by Yurchiu.</p></div><div class="natsuki-container" style="width:120px" data-bs-toggle="tooltip" title="Don't touch me! qwq"><img id="natsuki2" width="100%" height="100%" src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/natsuki2.png"> <img id="natsuki1" width="100%" height="100%" src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/natsuki1.png"></div><script type="text/javascript">$("#natsuki1").click(function(){$("#natsuki1").hide(),$("#natsuki2").show(),$("#natsuki2").css("animation","natsuki 0.55s cubic-bezier(0, 0, 0, 1)")}),$("#natsuki2").each(function(){$(this)[0].addEventListener("animationend",function(){$("#natsuki2").hide(),$("#natsuki1").show(),$(this).css("animation","")})})</script><script>readData("special")||$("html").addClass("none")</script><script>readData("color")||$("html").addClass("color-white"),4==readData("color")&&($("body").css("opacity","0.85"),$("body").css("background-image","url(https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/night-bgp.jpg)")),$("img").attr("onerror","this.src='https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/img/error.jpg';this.onerror=null"),initial()</script></div><meting-js class="meting-js appear" fixed="ture" server="netease" type="playlist" id="8524070964"></meting-js><script>consolePrint(),HideIt()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/custom/custom.css"><script src="https://cdn.jsdelivr.net/gh/yz-hs/yz-hs.github.io/custom/custom.js"></script></body></html>